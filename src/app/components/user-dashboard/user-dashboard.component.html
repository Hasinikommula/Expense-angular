<!-- Navbar -->
<nav class="navbar fixed-top">
  <div class="navbar-container">
    <div class="logo">
      <span class="logo-icon">ðŸ’²</span> ExpenseShare
    </div>
    <div class="nav-actions">
      <button class="nav-btn" (click)="refreshDashboard()">âŸ³ Refresh</button>
      <button class="nav-btn" (click)="openSettings()">âš™ Settings</button>
      <button class="nav-btn" (click)="logout()">ðŸšª Logout</button>
    </div>
    <h1 class="welcome">Welcome, {{ currentUser?.username }}</h1>
  </div>
</nav>

<div class="dashboard-container">
  <!-- Groups List -->
  <div *ngIf="view === 'dashboard'" class="section groups-list">
    <div class="header-actions">
      <h2>Your Groups ({{ groups.length }})</h2>
      <button class="create-btn" (click)="createNewGroup()">+ Create Group</button>
    </div>
    <div class="group-list">
      <div class="group-item" *ngFor="let group of groups" (click)="openGroup(group)">
        <h3>{{ group.name }}</h3>
        <p>{{ group.description }}</p>
        <span>{{ group.members?.length || 0 }} members</span>
      </div>
    </div>
  </div>

  <!-- Group Details -->
  <div *ngIf="view === 'groupDetail'" class="section group-details">
    <div class="header-actions">
      <button class="back-btn" (click)="goBack()">â¬… Back</button>
      <button class="edit-btn" (click)="editGroup()">âœŽ Edit Group</button>
    </div>
    <h2>{{ selectedGroup?.name }}</h2>
    <p>{{ selectedGroup?.description }}</p>

    <!-- Expenses -->
    <div class="expenses">
      <div class="header-actions">
        <h3>Expenses</h3>
        <button class="small-btn" (click)="addExpenseManually()">+ Add</button>
      </div>
      <div class="expense-item" *ngFor="let expense of expenses">
        <p><b>{{ expense.description }}</b> - ${{ expense.amount }}</p>
        <p>Paid by: {{ expense.paidBy }}</p>
      </div>
    </div>

    <!-- Add Expense Form -->
    <div class="add-expense" *ngIf="showAddExpenseForm">
      <h3>Add Expense</h3>
      <form (ngSubmit)="addExpense()" #expenseForm="ngForm">
        <input type="text" [(ngModel)]="newExpense.description" name="description" placeholder="Description" required />
        <input type="number" [(ngModel)]="newExpense.amount" name="amount" placeholder="Amount" step="0.01" required />
        <select [(ngModel)]="newExpense.paidBy" name="paidBy" required>
          <option value="" disabled selected>Select payer</option>
          <option *ngFor="let member of selectedGroup.members" [value]="member.username">
            {{ member.username }}
          </option>
        </select>
        <div class="form-actions">
          <button type="submit" class="save-btn">Save</button>
          <button type="button" class="cancel-btn" (click)="cancelAddExpense()">Cancel</button>
        </div>
      </form>
    </div>

    <!-- Balance Summary -->
    <div class="balance-summary">
      <h3>Balance Summary</h3>
      <div class="balance-item" *ngFor="let bal of balances">
        <p>{{ bal.from }} owes {{ bal.to }}: ${{ bal.amount.toFixed(2) }}</p>
      </div>
    </div>

    <!-- Payment Interface -->
    <div class="payment-interface">
      <h3>Make Payment</h3>
      <form (ngSubmit)="makePayment()" #paymentForm="ngForm">
        <select [(ngModel)]="payment.from" name="from" required>
          <option value="" disabled selected>Select payer</option>
          <option *ngFor="let member of selectedGroup.members" [value]="member.username">
            {{ member.username }}
          </option>
        </select>
        <select [(ngModel)]="payment.to" name="to" required>
          <option value="" disabled selected>Select receiver</option>
          <option *ngFor="let member of selectedGroup.members" [value]="member.username">
            {{ member.username }}
          </option>
        </select>
        <input type="number" [(ngModel)]="payment.amount" name="amount" placeholder="Amount" step="0.01" required />
        <div class="form-actions">
          <button type="submit" class="pay-btn">Pay (Dummy)</button>
          <button type="button" class="cancel-btn" (click)="cancelPayment()">Cancel</button>
        </div>
        <p *ngIf="paymentMessage" class="payment-message">{{ paymentMessage }}</p>
      </form>
    </div>
  </div>
</div>